# システムアーキテクチャ

## 概要

BAYSGAiA現金残高最大化システムは、Flutterベースのクロスプラットフォーム財務管理アプリケーションです。

## アーキテクチャ図

```
┌─────────────────────────────────────────────────────────────┐
│                      プレゼンテーション層                      │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐      │
│  │   Flutter    │  │  Material   │  │   Flutter   │      │
│  │   Widgets    │  │  Design 3   │  │   Charts    │      │
│  └─────────────┘  └─────────────┘  └─────────────┘      │
└─────────────────────────────────────────────────────────────┘
                              │
                              ▼
┌─────────────────────────────────────────────────────────────┐
│                         状態管理層                            │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐      │
│  │  Riverpod   │  │   Provider  │  │    State    │      │
│  │  Providers  │  │   Pattern   │  │  Notifier   │      │
│  └─────────────┘  └─────────────┘  └─────────────┘      │
└─────────────────────────────────────────────────────────────┘
                              │
                              ▼
┌─────────────────────────────────────────────────────────────┐
│                      ビジネスロジック層                        │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐      │
│  │   Domain     │  │   Use       │  │  Business   │      │
│  │   Entities  │  │   Cases     │  │   Rules     │      │
│  └─────────────┘  └─────────────┘  └─────────────┘      │
└─────────────────────────────────────────────────────────────┘
                              │
                              ▼
┌─────────────────────────────────────────────────────────────┐
│                        データ層                               │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐      │
│  │ Repository  │  │   Local     │  │   Remote    │      │
│  │  Pattern    │  │  Storage    │  │  API Client │      │
│  └─────────────┘  └─────────────┘  └─────────────┘      │
└─────────────────────────────────────────────────────────────┘
                              │
                              ▼
┌─────────────────────────────────────────────────────────────┐
│                        外部連携                               │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐      │
│  │GMOあおぞら  │  │  Claude     │  │   補助金    │      │
│  │ 銀行API     │  │    API      │  │  管理API    │      │
│  └─────────────┘  └─────────────┘  └─────────────┘      │
└─────────────────────────────────────────────────────────────┘
```

## 技術スタック詳細

### フロントエンド

#### Flutter Framework
- **バージョン**: Flutter 3.10.0以上
- **Dart**: 3.0.0以上
- **対応プラットフォーム**: iOS, Android, Web, Windows, macOS, Linux

#### UI/UXライブラリ
- **Material Design 3**: 最新のデザインシステム
- **Flutter Charts**: fl_chart 0.65.0 + Syncfusion Charts 23.2.6
- **アニメーション**: Flutter標準アニメーションAPI

### 状態管理

#### Riverpod
- **バージョン**: 2.4.9
- **パターン**: Provider Pattern + StateNotifier
- **利点**: 
  - コンパイル時の安全性
  - テスタビリティ
  - 依存性注入

### データ層

#### ローカルストレージ
- **Hive**: 2.2.3 - 高速NoSQLデータベース
- **Flutter Secure Storage**: 9.0.0 - 機密データ保存
- **Shared Preferences**: 2.2.2 - 簡単な設定保存

#### API通信
- **Dio**: 5.4.0 - 高機能HTTPクライアント
- **インターセプター**: 認証、ログ、エラーハンドリング
- **キャッシュ戦略**: オフライン対応

### アーキテクチャパターン

#### Clean Architecture
```
lib/
├── features/              # 機能別モジュール
│   ├── auth/
│   │   ├── domain/       # ビジネスロジック
│   │   ├── data/         # データ層実装
│   │   ├── pages/        # UI画面
│   │   └── providers/    # 状態管理
│   └── dashboard/
├── core/                  # 共通機能
│   ├── config/           # 設定
│   ├── services/         # 共通サービス
│   └── utils/            # ユーティリティ
└── shared/               # 共有コンポーネント
```

### 外部API連携

#### GMOあおぞらネット銀行API
- **認証**: OAuth 2.0
- **通信**: HTTPS (TLS 1.2+)
- **主要機能**:
  - 残高照会
  - 入出金明細取得
  - 振込状況確認

#### AI統合（Claude API）
- **用途**: 
  - 財務分析支援
  - 予測モデリング
  - 自然言語処理
- **セキュリティ**: APIキー管理、レート制限

## セキュリティアーキテクチャ

### 認証・認可
- **生体認証**: Touch ID / Face ID対応
- **多要素認証**: TOTP対応
- **セッション管理**: セキュアトークン管理

### データ保護
- **暗号化**: AES-256
- **通信**: Certificate Pinning
- **ローカル**: Flutter Secure Storage

### 監査
- **操作ログ**: 全重要操作記録
- **アクセスログ**: API呼び出し記録
- **コンプライアンス**: 電子帳簿保存法対応

## パフォーマンス最適化

### アプリケーション最適化
- **遅延読み込み**: ルートレベルでの実装
- **画像最適化**: WebP形式使用
- **キャッシュ戦略**: 
  - メモリキャッシュ
  - ディスクキャッシュ
  - HTTPキャッシュ

### レンダリング最適化
- **Widget再利用**: const constructor活用
- **リスト最適化**: ListView.builder使用
- **アニメーション**: 60fps維持

## クロスプラットフォーム対応

### プラットフォーム別最適化
- **iOS**: Cupertinoウィジェット対応
- **Android**: Material You対応
- **Web**: レスポンシブデザイン
- **Desktop**: キーボード・マウス操作最適化

### 画面サイズ対応
```dart
// レスポンシブブレークポイント
const kMobileBreakpoint = 600;
const kTabletBreakpoint = 900;
const kDesktopBreakpoint = 1200;
```

## 開発環境

### 必要ツール
- Flutter SDK 3.10.0+
- Dart SDK 3.0.0+
- Android Studio / VS Code
- Xcode（iOS開発時）

### 開発コマンド
```bash
# 依存関係インストール
flutter pub get

# コード生成
flutter pub run build_runner build

# 開発実行
flutter run

# テスト実行
flutter test

# ビルド
flutter build [platform]
```

## テスト戦略

### テストピラミッド
1. **単体テスト**: 70%
   - ビジネスロジック
   - ユーティリティ関数
   - データモデル

2. **ウィジェットテスト**: 20%
   - UI コンポーネント
   - 画面遷移
   - 状態管理

3. **統合テスト**: 10%
   - E2Eシナリオ
   - API連携
   - パフォーマンス

### テストツール
- **flutter_test**: 標準テストフレームワーク
- **mockito**: モック生成
- **integration_test**: 統合テスト

## CI/CD

### GitHub Actions
```yaml
# ビルド・テスト・デプロイ自動化
- flutter analyze
- flutter test
- flutter build
- 配布処理
```

### 配布戦略
- **iOS**: TestFlight
- **Android**: Google Play Console
- **Web**: Firebase Hosting
- **Desktop**: 直接配布

## 監視・分析

### アプリケーション監視
- **クラッシュレポート**: Firebase Crashlytics
- **パフォーマンス**: Firebase Performance
- **分析**: Google Analytics

### ログ管理
- **ローカルログ**: Logger package
- **リモートログ**: 集中ログ管理
- **デバッグ**: Flutter DevTools

## 将来の拡張性

### マイクロフロントエンド対応
- モジュール分離設計
- 動的機能読み込み
- フェデレーション対応準備

### AI機能拡張
- オンデバイスML
- リアルタイム予測
- 自然言語インターフェース